package org.openmrs.module.eptsreports.reporting.library.queries.mi;

public interface MICategory15QueriesInterface {

  class QUERY {

    public static final String findPatientsWithClinicalConsultationDuringRevisionPeriod =
        "Select maxEnc.patient_id from ( "
            + "Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id "
            + ")maxEnc";

    public static final String findPatientsWhoArePregnantSpecificForCategory15MI =
        " SELECT p.patient_id FROM person pe "
            + " INNER JOIN patient p ON pe.person_id = p.patient_id "
            + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
            + " INNER JOIN obs obsGravida ON e.encounter_id = obsGravida.encounter_id "
            + " WHERE pe.voided = 0 AND p.voided = 0 AND e.voided = 0 AND obsGravida.voided = 0 AND e.encounter_type = 6 AND e.location_id = :location "
            + " AND e.encounter_datetime between (:endRevisionDate - INTERVAL 11 MONTH + INTERVAL 1 DAY) and (:endRevisionDate - INTERVAL 2 MONTH) "
            + " AND obsGravida.concept_id = 1982 AND obsGravida.value_coded = 1065 AND pe.gender = 'F' "
            + " group by patient_id ";

    public static final String findPatientsWhoAreBreastfeedingSpecificForCategory15MI =
        " SELECT p.patient_id FROM person pe "
            + " INNER JOIN patient p ON pe.person_id = p.patient_id "
            + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
            + " INNER JOIN obs obsLactante ON e.encounter_id = obsLactante.encounter_id "
            + " WHERE pe.voided = 0 AND p.voided = 0 AND e.voided = 0 AND obsLactante.voided = 0 AND e.encounter_type = 6 AND e.location_id = :location "
            + " AND e.encounter_datetime between (:endRevisionDate - INTERVAL 20 MONTH + INTERVAL 1 DAY) and (:endRevisionDate - INTERVAL 2 MONTH) "
            + " AND obsLactante.concept_id = 6332 AND obsLactante.value_coded = 1065 AND pe.gender = 'F' "
            + " group by patient_id ";

    public static final String
        findPatientsWithClinicalConsultationAndARTStartDateGreaterThanThreeMonths =
            " SELECT patient_id from ( "
                + " select art.patient_id, art.art_start_date from (SELECT patient_id, art_start_date FROM ( "
                + " SELECT patient_id, MIN(art_start_date) art_start_date FROM ( "
                + " SELECT p.patient_id, MIN(value_datetime) art_start_date FROM patient p "
                + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
                + " INNER JOIN obs o ON e.encounter_id = o.encounter_id "
                + " WHERE p.voided = 0 AND e.voided = 0 AND o.voided = 0 AND e.encounter_type = 53 "
                + " AND o.concept_id = 1190 AND o.value_datetime is NOT NULL AND o.value_datetime <= :endRevisionDate AND e.location_id = :location "
                + " GROUP BY p.patient_id "
                + " ) art_start "
                + " GROUP BY art_start.patient_id "
                + " ) tx_new "
                + ") art "
                + "inner join "
                + "(select patient_id, encounter_datetime from ( "
                + "select p.patient_id, max(e.encounter_datetime) encounter_datetime FROM patient p "
                + "INNER JOIN encounter e on p.patient_id=e.patient_id "
                + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
                + "and e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate "
                + "and e.location_id=:location "
                + "group by p.patient_id "
                + ") maxEnc ) consulta on consulta.patient_id = art.patient_id "
                + "INNER JOIN person pe ON art.patient_id=pe.person_id "
                + "and (TIMESTAMPDIFF(year,pe.birthdate,consulta.encounter_datetime)) >2 AND pe.birthdate IS NOT NULL and pe.voided = 0 "
                + "where (TIMESTAMPDIFF(MONTH,art.art_start_date,consulta.encounter_datetime)) >3 "
                + ") final ";

    public static final String
        findPatientsWithClinicalConsultationAndARTStartDateGreaterThanTwentyOneMonths =
            " SELECT patient_id from ( "
                + " select art.patient_id, art.art_start_date from (SELECT patient_id, art_start_date FROM ( "
                + " SELECT patient_id, MIN(art_start_date) art_start_date FROM ( "
                + " SELECT p.patient_id, MIN(value_datetime) art_start_date FROM patient p "
                + " INNER JOIN encounter e ON p.patient_id = e.patient_id "
                + " INNER JOIN obs o ON e.encounter_id = o.encounter_id "
                + " WHERE p.voided = 0 AND e.voided = 0 AND o.voided = 0 AND e.encounter_type = 53 "
                + " AND o.concept_id = 1190 AND o.value_datetime is NOT NULL AND o.value_datetime <= :endRevisionDate AND e.location_id = :location "
                + " GROUP BY p.patient_id "
                + " ) art_start "
                + " GROUP BY art_start.patient_id "
                + " ) tx_new "
                + ") art "
                + "inner join "
                + "(select patient_id, encounter_datetime from ( "
                + "select p.patient_id, max(e.encounter_datetime) encounter_datetime FROM patient p "
                + "INNER JOIN encounter e on p.patient_id=e.patient_id "
                + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
                + "and e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate "
                + "and e.location_id=:location "
                + "group by p.patient_id "
                + ") maxEnc ) consulta on consulta.patient_id = art.patient_id "
                + "where (TIMESTAMPDIFF(MONTH,art.art_start_date,consulta.encounter_datetime)) >21 "
                + ") final ";

    public static final String findPatientsWithClinicalConsultationOrARTPickUpInTheLastThreeMonths =
        "select patient_id from (select maxEnc.patient_id from ( "
            + "select p.patient_id, max(e.encounter_datetime) encounter_datetime FROM patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and  e.encounter_type = 6 "
            + "and e.encounter_datetime between :startInclusionDate and :endInclusionDate "
            + "and e.location_id=:location "
            + "group by p.patient_id "
            + "UNION "
            + "SELECT p.patient_id,max(value_datetime) as encounter_datetime FROM patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on e.encounter_id=o.encounter_id "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and e.encounter_type=52 AND o.concept_id=23866 and e.location_id=:location "
            + "and e.encounter_datetime between :startInclusionDate and :endInclusionDate "
            + "group by patient_id "
            + ")maxEnc "
            + "inner join "
            + "encounter terceiroMes on maxEnc.patient_id = terceiroMes.patient_id "
            + "and terceiroMes.voided = 0 and terceiroMes.encounter_type in (6,52) and "
            + "terceiroMes.encounter_datetime between (maxEnc.encounter_datetime - INTERVAL 30 DAY) and (maxEnc.encounter_datetime - INTERVAL 1 DAY) "
            + "and terceiroMes.location_id=:location "
            + "inner join "
            + "encounter segundoMes on maxEnc.patient_id = segundoMes.patient_id "
            + "and segundoMes.voided = 0 and segundoMes.encounter_type in (6,52) and "
            + "segundoMes.encounter_datetime between (maxEnc.encounter_datetime - INTERVAL 60 DAY) and (maxEnc.encounter_datetime - INTERVAL 31 DAY) "
            + "and segundoMes.location_id=:location "
            + "inner join "
            + "encounter primeiroMes on maxEnc.patient_id = primeiroMes.patient_id "
            + "and primeiroMes.voided = 0 and primeiroMes.encounter_type in (6,52) and "
            + "primeiroMes.encounter_datetime between (maxEnc.encounter_datetime - INTERVAL 90 DAY) and (maxEnc.encounter_datetime - INTERVAL 61 DAY) "
            + "and primeiroMes.location_id=:location "
            + ") final group by final.patient_id ";

    public static final String findPatientsWithTheLastCD4LessThan200OrEqualInClinicalConsultation =
        "select patient_id from (Select maxEnc.patient_id, cd4.obs_datetime, encounter_datetime from ( "
            + "Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id "
            + ")maxEnc "
            + "inner join "
            + "(select distinct max_cd4.patient_id,o.value_numeric, o.obs_datetime from ( "
            + "Select p.patient_id,max(o.obs_datetime) max_data_cd4  From patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on e.encounter_id=o.encounter_id "
            + "where p.voided=0 and e.voided=0 and o.voided=0 and concept_id = 1695 and  e.encounter_type = 6 and e.location_id=:location group by p.patient_id "
            + ")max_cd4 "
            + "inner join obs o on o.person_id=max_cd4.patient_id and max_cd4.max_data_cd4=o.obs_datetime and o.voided=0 and "
            + "o.concept_id =1695 and o.value_numeric<=200 and o.location_id=:location "
            + ")cd4 on cd4.patient_id = maxEnc.patient_id and cd4.obs_datetime < maxEnc.encounter_datetime "
            + ")final ";

    public static final String
        findPatientsWithTheLastCargaViralGreaterOrEqualThan1000InClinicalConsultation =
            " select patient_id from (select maxEnc.patient_id, ultimaCVAlta.data_carga, encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
                + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
                + "group by p.patient_id "
                + ")maxEnc "
                + "  inner join "
                + " ( Select p.patient_id, max(e.encounter_datetime) data_carga "
                + " from patient p "
                + " inner join encounter e on p.patient_id = e.patient_id "
                + " inner join obs o on e.encounter_id=o.encounter_id "
                + " where 	p.voided = 0 and e.voided = 0 and o.voided = 0 and e.encounter_type = 6 and  o.concept_id = 856 and e.location_id = :location and o.value_numeric >= 1000 "
                + " group by p.patient_id "
                + " ) ultimaCVAlta on ultimaCVAlta.patient_id = maxEnc.patient_id and ultimaCVAlta.data_carga < maxEnc.encounter_datetime "
                + " )final ";

    public static final String
        findPatientsWithTheLastCargaViralGreaterOrEqualThan1000RegisteredInTheLastClinicalConsultation =
            " select patient_id from (select maxEnc.patient_id, ultimaCVAlta.data_carga, encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
                + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
                + "group by p.patient_id "
                + ")maxEnc "
                + "  inner join "
                + " ( Select p.patient_id, max(e.encounter_datetime) data_carga "
                + " from patient p "
                + " inner join encounter e on p.patient_id = e.patient_id "
                + " inner join obs o on e.encounter_id=o.encounter_id "
                + " where 	p.voided = 0 and e.voided = 0 and o.voided = 0 and e.encounter_type = 6 and  o.concept_id = 856 and e.location_id = :location and o.value_numeric >= 1000 "
                + " group by p.patient_id "
                + " ) ultimaCVAlta on ultimaCVAlta.patient_id = maxEnc.patient_id and ultimaCVAlta.data_carga = maxEnc.encounter_datetime "
                + " )final ";

    public static final String findPatientsRegisteredAsIniciarGAAC =
        "select patient_id from (select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id)maxEnc "
            + "inner join "
            + "(select patient_id,max_datagaac from( "
            + "Select gm.member_id as patient_id,gm.start_date as max_datagaac from gaac g "
            + "inner join gaac_member gm on g.gaac_id=gm.gaac_id "
            + "where gm.start_date<=:endInclusionDate and gm.voided=0 and g.voided=0 and ((leaving is null) or (leaving=0) or (leaving=1 and gm.end_date>:endInclusionDate)) and location_id=:location "
            + "union "
            + "select max_gaac.patient_id,max_datagaac from( "
            + "select p.patient_id,max(o.obs_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23724 and e.location_id=:location and o.obs_datetime<=:endInclusionDate "
            + "group by p.patient_id "
            + ") max_gaac "
            + "inner join encounter e on e.patient_id=max_gaac.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where  max_gaac.max_datagaac=obs.obs_datetime and obs.concept_id=23724 and obs.value_coded = 1256 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") gaac "
            + "where patient_id not in( "
            + "select max_gaac.patient_id from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23724 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ")max_gaac "
            + "inner join encounter e on e.patient_id=max_gaac.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_gaac.max_datagaac=obs.obs_datetime and obs.concept_id=23724 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ")) gaac on maxEnc.patient_id = gaac.patient_id and gaac.max_datagaac = maxEnc.encounter_datetime "
            + ") finalgaac ";

    public static final String findPatientsRegisteredAsIniciarDT =
        "select patient_id from ( "
            + "select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id)maxEnc "
            + "inner join "
            + "(select patient_id,data_levantamento from ( "
            + "select levantamento.patient_id,data_levantamento  from ( "
            + "select p.patient_id,max(e.encounter_datetime) data_levantamento from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=18 and date(e.encounter_datetime)<=:endInclusionDate and e.location_id=:location "
            + "group by p.patient_id "
            + ")levantamento "
            + "inner join encounter e on e.patient_id = levantamento.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where levantamento.data_levantamento=e.encounter_datetime and o.concept_id=5096 and "
            + "e.encounter_type=18 and e.voided=0 and o.voided=0 and e.location_id=:location and  datediff(o.value_datetime,levantamento.data_levantamento) between 83 and 97 "
            + "union "
            + "select max_tl.patient_id,max_datatl from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datatl from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id) max_tl "
            + "inner join obs on obs.person_id=max_tl.patient_id and max_tl.max_datatl=obs.obs_datetime "
            + "where obs.concept_id=23739 and obs.value_coded=23720 and obs.voided=0 and obs.location_id=:location "
            + "union "
            + "select max_dt.patient_id,max_datadt from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datadt from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23730 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dt "
            + "inner join encounter e on e.patient_id=max_dt.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dt.max_datadt=obs.obs_datetime and obs.concept_id=23730 and obs.value_coded = 1256 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") dt "
            + "where patient_id not in (select max_dts.patient_id from( "
            + "select p.patient_id,max(o.obs_datetime) max_datadts from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23730 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dts "
            + "inner join encounter e on e.patient_id=max_dts.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dts.max_datadts=obs.obs_datetime and obs.concept_id=23730 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ")) dt on dt.patient_id = maxEnc.patient_id and dt.data_levantamento = maxEnc.encounter_datetime "
            + ") finalDT ";

    public static final String findPatientsRegisteredAsIniciarDS =
        "select patient_id from ( "
            + "select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id) maxEnc "
            + "inner join "
            + "(select patient_id,data_levantamento from( "
            + "select levantamento.patient_id,data_levantamento from ( "
            + "select p.patient_id,max(e.encounter_datetime) data_levantamento from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=18 and date(e.encounter_datetime)<=:endInclusionDate and e.location_id=:location "
            + "group by p.patient_id "
            + ")levantamento "
            + "inner join encounter e on e.patient_id = levantamento.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where levantamento.data_levantamento=e.encounter_datetime and o.concept_id=5096 and "
            + "e.encounter_type=18 and e.voided=0 and o.voided=0 and e.location_id=:location and  datediff(o.value_datetime,levantamento.data_levantamento) between 175 and 190 "
            + "union "
            + "select max_tl.patient_id,max_datatl from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datatl from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_tl "
            + "inner join obs on obs.person_id=max_tl.patient_id and max_tl.max_datatl=obs.obs_datetime "
            + "where obs.concept_id=23739 and obs.value_coded=23888 and obs.voided=0 and obs.location_id=:location union "
            + "select max_dt.patient_id,max_datadt from( "
            + "select p.patient_id,max(o.obs_datetime) max_datadt from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23888 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dt "
            + " inner join encounter e on e.patient_id=max_dt.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dt.max_datadt=obs.obs_datetime and obs.concept_id=23888 and obs.voided=0 and obs.value_coded = 1256 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") dt "
            + "where patient_id not in( "
            + "select max_dts.patient_id from( "
            + "select p.patient_id,max(o.obs_datetime) max_datadts from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23888 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dts "
            + "inner join encounter e on max_dts.patient_id=e.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dts.max_datadts=obs.obs_datetime and obs.concept_id=23888 and obs.voided=0 and obs.value_coded=1267 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 ) "
            + ") ds on ds.patient_id = maxEnc.patient_id and ds.data_levantamento = maxEnc.encounter_datetime "
            + ") dsFinal ";

    public static final String findPatientsRegisteredAsIniciarFR =
        "select patient_id from (select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id) maxEnc "
            + "inner join "
            + "(select patient_id, data_consulta from( "
            + "select ultimaConsulta.patient_id, data_consulta from 	( "
            + "select p.patient_id,max(e.encounter_datetime) data_consulta from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type in (6) and  date(e.encounter_datetime) <= :endInclusionDate and e.location_id=:location "
            + "group by p.patient_id "
            + ") ultimaConsulta "
            + "inner join encounter e on e.patient_id=ultimaConsulta.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where ultimaConsulta.data_consulta= e.encounter_datetime and o.concept_id=1410 and o.voided=0 and e.voided=0 and e.location_id=:location and "
            + "e.encounter_type in (6,9) and datediff(o.value_datetime,ultimaConsulta.data_consulta) between 175 and 190 "
            + "union "
            + "select max_fr.patient_id,max_datafr from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datafr from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23729 and e.location_id=:location and o.obs_datetime<=:endInclusionDate "
            + "group by p.patient_id "
            + ") max_fr "
            + " inner join encounter e on e.patient_id=max_fr.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where  max_fr.max_datafr=obs.obs_datetime and obs.concept_id=23729 and obs.value_coded = 1256 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") fr "
            + "where patient_id not in ( "
            + "select max_fr.patient_id from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datafr from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23729 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_fr "
            + "inner join encounter e on e.patient_id=max_fr.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_fr.max_datafr=obs.obs_datetime and obs.concept_id=23729 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ")) fr on fr.patient_id = maxEnc.patient_id and fr.data_consulta = maxEnc.encounter_datetime "
            + ") finalFR ";

    public static final String findPatientsRegisteredAsIniciarDC =
        "select patient_id from ( "
            + "select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id) maxEnc "
            + "inner join "
            + "(SELECT max_dc.patient_id, max_datadc from  ( "
            + "SELECT p.patient_id,max(o.obs_datetime) max_datadc from patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "INNER JOIN obs o on o.encounter_id=e.encounter_id "
            + "WHERE e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 "
            + "and o.concept_id=23731 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dc "
            + " inner join encounter e on e.patient_id=max_dc.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dc.max_datadc=obs.obs_datetime and obs.concept_id=23731 and obs.value_coded = 1256 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") dc on dc.patient_id = maxEnc.patient_id and dc.max_datadc = maxEnc.encounter_datetime "
            + ") finalDC ";

    public static final String findPatientsRegisteredAsFimGAAC =
        "select patient_id from (select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id)maxEnc "
            + "inner join "
            + "(select patient_id,max_datagaac from( "
            + "Select gm.member_id as patient_id,gm.start_date as max_datagaac from gaac g "
            + "inner join gaac_member gm on g.gaac_id=gm.gaac_id "
            + "where gm.start_date<=:endInclusionDate and gm.voided=0 and g.voided=0 and ((leaving is null) or (leaving=0) or (leaving=1 and gm.end_date>:endInclusionDate)) and location_id=:location "
            + "union "
            + "select max_gaac.patient_id,max_datagaac from( "
            + "select p.patient_id,max(o.obs_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23724 and e.location_id=:location and o.obs_datetime<=:endInclusionDate "
            + "group by p.patient_id "
            + ") max_gaac "
            + "inner join encounter e on e.patient_id=max_gaac.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where  max_gaac.max_datagaac=obs.obs_datetime and obs.concept_id=23724 and obs.value_coded in (1256,1257) and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") gaac "
            + "where patient_id in( "
            + "select max_gaac.patient_id from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23724 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ")max_gaac "
            + "inner join encounter e on e.patient_id=max_gaac.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_gaac.max_datagaac=obs.obs_datetime and obs.concept_id=23724 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ")) gaac on maxEnc.patient_id = gaac.patient_id and gaac.max_datagaac = maxEnc.encounter_datetime "
            + ") finalgaac ";

    public static final String findPatientsRegisteredAsFimDT =
        "select patient_id from ( "
            + "select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id)maxEnc "
            + "inner join "
            + "(select patient_id,data_levantamento from ( "
            + "select levantamento.patient_id,data_levantamento  from ( "
            + "select p.patient_id,max(e.encounter_datetime) data_levantamento from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=18 and date(e.encounter_datetime)<=:endInclusionDate and e.location_id=:location "
            + "group by p.patient_id "
            + ")levantamento "
            + "inner join encounter e on e.patient_id = levantamento.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where levantamento.data_levantamento=e.encounter_datetime and o.concept_id=5096 and "
            + "e.encounter_type=18 and e.voided=0 and o.voided=0 and e.location_id=:location and  datediff(o.value_datetime,levantamento.data_levantamento) between 83 and 97 "
            + "union "
            + "select max_tl.patient_id,max_datatl from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datatl from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id) max_tl "
            + "inner join obs on obs.person_id=max_tl.patient_id and max_tl.max_datatl=obs.obs_datetime "
            + "where obs.concept_id=23739 and obs.value_coded=23720 and obs.voided=0 and obs.location_id=:location "
            + "union "
            + "select max_dt.patient_id,max_datadt from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datadt from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23730 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dt "
            + "inner join encounter e on e.patient_id=max_dt.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dt.max_datadt=obs.obs_datetime and obs.concept_id=23730 and obs.value_coded in (1256,1257) and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") dt "
            + "where patient_id in (select max_dts.patient_id from( "
            + "select p.patient_id,max(o.obs_datetime) max_datadts from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23730 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dts "
            + "inner join encounter e on e.patient_id=max_dts.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dts.max_datadts=obs.obs_datetime and obs.concept_id=23730 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ")) dt on dt.patient_id = maxEnc.patient_id and dt.data_levantamento = maxEnc.encounter_datetime "
            + ") finalDT ";

    public static final String findPatientsRegisteredAsFimDS =
        "select patient_id from ( "
            + "select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id) maxEnc "
            + "inner join "
            + "(select patient_id,data_levantamento from( "
            + "select levantamento.patient_id,data_levantamento from ( "
            + "select p.patient_id,max(e.encounter_datetime) data_levantamento from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=18 and date(e.encounter_datetime)<=:endInclusionDate and e.location_id=:location "
            + "group by p.patient_id "
            + ")levantamento "
            + "inner join encounter e on e.patient_id = levantamento.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where levantamento.data_levantamento=e.encounter_datetime and o.concept_id=5096 and "
            + "e.encounter_type=18 and e.voided=0 and o.voided=0 and e.location_id=:location and  datediff(o.value_datetime,levantamento.data_levantamento) between 175 and 190 "
            + "union "
            + "select max_tl.patient_id,max_datatl from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datatl from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_tl "
            + "inner join obs on obs.person_id=max_tl.patient_id and max_tl.max_datatl=obs.obs_datetime "
            + "where obs.concept_id=23739 and obs.value_coded=23888 and obs.voided=0 and obs.location_id=:location union "
            + "select max_dt.patient_id,max_datadt from( "
            + "select p.patient_id,max(o.obs_datetime) max_datadt from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23888 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dt "
            + " inner join encounter e on e.patient_id=max_dt.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dt.max_datadt=obs.obs_datetime and obs.concept_id=23888 and obs.voided=0 and obs.value_coded in (1256,1257) and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") dt "
            + "where patient_id in( "
            + "select max_dts.patient_id from( "
            + "select p.patient_id,max(o.obs_datetime) max_datadts from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23888 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dts "
            + "inner join encounter e on max_dts.patient_id=e.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dts.max_datadts=obs.obs_datetime and obs.concept_id=23888 and obs.voided=0 and obs.value_coded=1267 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 ) "
            + ") ds on ds.patient_id = maxEnc.patient_id and ds.data_levantamento = maxEnc.encounter_datetime "
            + ") dsFinal ";

    public static final String findPatientsRegisteredAsFimFR =
        "select patient_id from (select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id) maxEnc "
            + "inner join "
            + "(select patient_id, data_consulta from( "
            + "select ultimaConsulta.patient_id, data_consulta from 	( "
            + "select p.patient_id,max(e.encounter_datetime) data_consulta from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type in (6) and  date(e.encounter_datetime) <= :endInclusionDate and e.location_id=:location "
            + "group by p.patient_id "
            + ") ultimaConsulta "
            + "inner join encounter e on e.patient_id=ultimaConsulta.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where ultimaConsulta.data_consulta= e.encounter_datetime and o.concept_id=1410 and o.voided=0 and e.voided=0 and e.location_id=:location and "
            + "e.encounter_type in (6,9) and datediff(o.value_datetime,ultimaConsulta.data_consulta) between 175 and 190 "
            + "union "
            + "select max_fr.patient_id,max_datafr from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datafr from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23729 and e.location_id=:location and o.obs_datetime<=:endInclusionDate "
            + "group by p.patient_id "
            + ") max_fr "
            + " inner join encounter e on e.patient_id=max_fr.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where  max_fr.max_datafr=obs.obs_datetime and obs.concept_id=23729 and obs.value_coded in (1256,1257) and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") fr "
            + "where patient_id in ( "
            + "select max_fr.patient_id from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datafr from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23729 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_fr "
            + "inner join encounter e on e.patient_id=max_fr.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_fr.max_datafr=obs.obs_datetime and obs.concept_id=23729 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ")) fr on fr.patient_id = maxEnc.patient_id and fr.data_consulta = maxEnc.encounter_datetime "
            + ") finalFR ";

    public static final String findPatientsRegisteredAsFimDC =
        "select patient_id from ( "
            + "select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id) maxEnc "
            + "inner join "
            + "(SELECT max_dc.patient_id, max_datadc from  ( "
            + "SELECT p.patient_id,max(o.obs_datetime) max_datadc from patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "INNER JOIN obs o on o.encounter_id=e.encounter_id "
            + "WHERE e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 "
            + "and o.concept_id=23731 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dc "
            + " inner join encounter e on e.patient_id=max_dc.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dc.max_datadc=obs.obs_datetime and obs.concept_id=23731 and obs.value_coded = 1267 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") dc on dc.patient_id = maxEnc.patient_id and dc.max_datadc = maxEnc.encounter_datetime "
            + ") finalDC ";

    public static final String
        findPatientsRegisteredInOneMDSForStablePatientsAndHadCVBetweenTwelveAndEigtheenMonthsAfterCVLessThan1000 =
            "select patient_id from (select patient_id, data_carga from (select maxEnc.patient_id, ultimaCVAlta.data_carga, encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
                + "inner join encounter e on p.patient_id=e.patient_id "
                + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
                + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
                + "group by p.patient_id "
                + ")maxEnc "
                + "  inner join "
                + " ( Select p.patient_id, max(e.encounter_datetime) data_carga "
                + " from patient p "
                + " inner join encounter e on p.patient_id = e.patient_id "
                + " inner join obs o on e.encounter_id=o.encounter_id "
                + " where p.voided = 0 and e.voided = 0 and o.voided = 0 and e.encounter_type = 6 and ((o.concept_id = 856 and o.value_numeric < 1000) OR (o.concept_id = 1305 and o.value_coded is not null)) and e.location_id = :location "
                + " group by p.patient_id "
                + " ) ultimaCVAlta on ultimaCVAlta.patient_id = maxEnc.patient_id and ultimaCVAlta.data_carga < (maxEnc.encounter_datetime - INTERVAL 12 MONTH) "
                + " )final "
                + " where patient_id in "
                + " (Select p.patient_id "
                + " from patient p "
                + " inner join encounter e on p.patient_id = e.patient_id "
                + " inner join obs o on e.encounter_id=o.encounter_id "
                + " where p.voided = 0 and e.voided = 0 and o.voided = 0 and e.encounter_type = 6 and o.concept_id = 856 and o.value_numeric is not null "
                + " and e.location_id = :location "
                + " and e.encounter_datetime between (final.data_carga + INTERVAL 12 MONTH) and (final.data_carga + INTERVAL 18 MONTH) "
                + " group by p.patient_id)) final ";

    public static final String findPatientsWhoAreCommunityAdherenceGroups =
        "select patient_id from (select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id)maxEnc "
            + "inner join "
            + "(select patient_id,max_datagaac from( "
            + "Select gm.member_id as patient_id,gm.start_date as max_datagaac from gaac g "
            + "inner join gaac_member gm on g.gaac_id=gm.gaac_id "
            + "where gm.start_date<=:endInclusionDate and gm.voided=0 and g.voided=0 and ((leaving is null) or (leaving=0) or (leaving=1 and gm.end_date>:endInclusionDate)) and location_id=:location "
            + "union "
            + "select max_gaac.patient_id,max_datagaac from( "
            + "select p.patient_id,max(o.obs_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23724 and e.location_id=:location and o.obs_datetime<=:endInclusionDate "
            + "group by p.patient_id "
            + ") max_gaac "
            + "inner join encounter e on e.patient_id=max_gaac.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where  max_gaac.max_datagaac=obs.obs_datetime and obs.concept_id=23724 and obs.value_coded in (1256,1257) and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") gaac "
            + "where patient_id not in( "
            + "select max_gaac.patient_id from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datagaac from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23724 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ")max_gaac "
            + "inner join encounter e on e.patient_id=max_gaac.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_gaac.max_datagaac=obs.obs_datetime and obs.concept_id=23724 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ")) gaac on maxEnc.patient_id = gaac.patient_id and gaac.max_datagaac < maxEnc.encounter_datetime "
            + ") finalgaac ";

    public static final String findPatientsWhoAreThreeMonthsDrugDistribution =
        "select patient_id from ( "
            + "select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id)maxEnc "
            + "inner join "
            + "(select patient_id,data_levantamento from ( "
            + "select levantamento.patient_id,data_levantamento  from ( "
            + "select p.patient_id,max(e.encounter_datetime) data_levantamento from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=18 and date(e.encounter_datetime)<=:endInclusionDate and e.location_id=:location "
            + "group by p.patient_id "
            + ")levantamento "
            + "inner join encounter e on e.patient_id = levantamento.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where levantamento.data_levantamento=e.encounter_datetime and o.concept_id=5096 and "
            + "e.encounter_type=18 and e.voided=0 and o.voided=0 and e.location_id=:location and  datediff(o.value_datetime,levantamento.data_levantamento) between 83 and 97 "
            + "union "
            + "select max_tl.patient_id,max_datatl from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datatl from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id) max_tl "
            + "inner join obs on obs.person_id=max_tl.patient_id and max_tl.max_datatl=obs.obs_datetime "
            + "where obs.concept_id=23739 and obs.value_coded=23720 and obs.voided=0 and obs.location_id=:location "
            + "union "
            + "select max_dt.patient_id,max_datadt from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datadt from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23730 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dt "
            + "inner join encounter e on e.patient_id=max_dt.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dt.max_datadt=obs.obs_datetime and obs.concept_id=23730 and obs.value_coded in (1256,1257) and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") dt "
            + "where patient_id not in (select max_dts.patient_id from( "
            + "select p.patient_id,max(o.obs_datetime) max_datadts from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23730 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dts "
            + "inner join encounter e on e.patient_id=max_dts.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dts.max_datadts=obs.obs_datetime and obs.concept_id=23730 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ")) dt on dt.patient_id = maxEnc.patient_id and dt.data_levantamento < maxEnc.encounter_datetime "
            + ") finalDT ";

    public static final String findPatientsWhoAreFastTrack =
        "select patient_id from (select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id) maxEnc "
            + "inner join "
            + "(select patient_id, data_consulta from( "
            + "select ultimaConsulta.patient_id, data_consulta from 	( "
            + "select p.patient_id,max(e.encounter_datetime) data_consulta from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type in (6) and  date(e.encounter_datetime) <= :endInclusionDate and e.location_id=:location "
            + "group by p.patient_id "
            + ") ultimaConsulta "
            + "inner join encounter e on e.patient_id=ultimaConsulta.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where ultimaConsulta.data_consulta= e.encounter_datetime and o.concept_id=1410 and o.voided=0 and e.voided=0 and e.location_id=:location and "
            + "e.encounter_type in (6,9) and datediff(o.value_datetime,ultimaConsulta.data_consulta) between 175 and 190 "
            + "union "
            + "select max_fr.patient_id,max_datafr from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datafr from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23729 and e.location_id=:location and o.obs_datetime<=:endInclusionDate "
            + "group by p.patient_id "
            + ") max_fr "
            + " inner join encounter e on e.patient_id=max_fr.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where  max_fr.max_datafr=obs.obs_datetime and obs.concept_id=23729 and obs.value_coded in (1256,1257) and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") fr "
            + "where patient_id not in ( "
            + "select max_fr.patient_id from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datafr from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23729 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_fr "
            + "inner join encounter e on e.patient_id=max_fr.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_fr.max_datafr=obs.obs_datetime and obs.concept_id=23729 and obs.value_coded=1267 and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ")) fr on fr.patient_id = maxEnc.patient_id and fr.data_consulta < maxEnc.encounter_datetime "
            + ") finalFR ";

    public static final String findPatientsWhoAreInCommunityDrugsDistribution =
        "select patient_id from ( "
            + "select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id) maxEnc "
            + "inner join "
            + "(SELECT max_dc.patient_id, max_datadc from  ( "
            + "SELECT p.patient_id,max(o.obs_datetime) max_datadc from patient p "
            + "INNER JOIN encounter e on p.patient_id=e.patient_id "
            + "INNER JOIN obs o on o.encounter_id=e.encounter_id "
            + "WHERE e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 "
            + "and o.concept_id=23731 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dc "
            + " inner join encounter e on e.patient_id=max_dc.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dc.max_datadc=obs.obs_datetime and obs.concept_id=23731 and obs.value_coded in (1256,1257) and obs.voided=0 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") dc on dc.patient_id = maxEnc.patient_id and dc.max_datadc < maxEnc.encounter_datetime "
            + ") finalDC ";

    public static final String findPatientsWhoAreSixMonthsDrugsDistribution =
        "select patient_id from ( "
            + "select maxEnc.patient_id, maxEnc.encounter_datetime from (Select p.patient_id,max(e.encounter_datetime) encounter_datetime from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=6 and "
            + "e.encounter_datetime >=:startInclusionDate and e.encounter_datetime<=:endInclusionDate  and e.location_id=:location "
            + "group by p.patient_id) maxEnc "
            + "inner join "
            + "(select patient_id,data_levantamento from( "
            + "select levantamento.patient_id,data_levantamento from ( "
            + "select p.patient_id,max(e.encounter_datetime) data_levantamento from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "where p.voided=0 and e.voided=0 and e.encounter_type=18 and date(e.encounter_datetime)<=:endInclusionDate and e.location_id=:location "
            + "group by p.patient_id "
            + ")levantamento "
            + "inner join encounter e on e.patient_id = levantamento.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where levantamento.data_levantamento=e.encounter_datetime and o.concept_id=5096 and "
            + "e.encounter_type=18 and e.voided=0 and o.voided=0 and e.location_id=:location and  datediff(o.value_datetime,levantamento.data_levantamento) between 175 and 190 "
            + "union "
            + "select max_tl.patient_id,max_datatl from ( "
            + "select p.patient_id,max(o.obs_datetime) max_datatl from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23739 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_tl "
            + "inner join obs on obs.person_id=max_tl.patient_id and max_tl.max_datatl=obs.obs_datetime "
            + "where obs.concept_id=23739 and obs.value_coded=23888 and obs.voided=0 and obs.location_id=:location union "
            + "select max_dt.patient_id,max_datadt from( "
            + "select p.patient_id,max(o.obs_datetime) max_datadt from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23888 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dt "
            + " inner join encounter e on e.patient_id=max_dt.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dt.max_datadt=obs.obs_datetime and obs.concept_id=23888 and obs.voided=0 and obs.value_coded in (1256,1257) and obs.location_id=:location and e.encounter_type=6 and e.voided=0 "
            + ") dt "
            + "where patient_id not in( "
            + "select max_dts.patient_id from( "
            + "select p.patient_id,max(o.obs_datetime) max_datadts from patient p "
            + "inner join encounter e on p.patient_id=e.patient_id "
            + "inner join obs o on o.encounter_id=e.encounter_id "
            + "where e.encounter_type=6 and e.voided=0 and o.voided=0 and p.voided=0 and o.concept_id=23888 and e.location_id=:location and o.obs_datetime<=:endInclusionDate group by p.patient_id "
            + ") max_dts "
            + "inner join encounter e on max_dts.patient_id=e.patient_id "
            + "inner join obs on obs.encounter_id=e.encounter_id "
            + "where max_dts.max_datadts=obs.obs_datetime and obs.concept_id=23888 and obs.voided=0 and obs.value_coded=1267 and obs.location_id=:location and e.encounter_type=6 and e.voided=0 ) "
            + ") ds on ds.patient_id = maxEnc.patient_id and ds.data_levantamento < maxEnc.encounter_datetime "
            + ") dsFinal ";
  }
}
